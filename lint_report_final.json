[{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\App.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":36,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[24,35],"text":""},"desc":"Remove unused variable \"useEffect\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo, useCallback } from 'react';\r\nimport DraggableWindow from './components/DraggableWindow';\r\nimport LeftSidebar from './features/LeftSidebar';\r\nimport ChatArea from './features/ChatArea';\r\nimport RightSidebar from './features/RightSidebar';\r\nimport { useCourtSession, ROLE_MAPPINGS } from './hooks/useCourtSession';\r\nimport { useWindowManager } from './hooks/useWindowManager';\r\nimport type {\r\n    TextEvidence,\r\n    FileEvidence,\r\n    UserRole,\r\n    LayoutConfig,\r\n    CaseDataConfig,\r\n    EvidenceDataConfig,\r\n    NewEvidenceInputConfig,\r\n    SessionInfoConfig\r\n} from './types';\r\n\r\n// --- Main Application ---\r\nexport default function MockCourtApp(): React.ReactElement {\r\n    // --- Session Hook (single line to access all session logic) ---\r\n    const { sessionState, actions } = useCourtSession();\r\n\r\n    // Destructure for convenience\r\n    const {\r\n        messages, isConnected, isConnecting, sessionId,\r\n        currentPhase, currentSpeaker, activeNode, isTurnToSpeak, logs\r\n    } = sessionState;\r\n\r\n    const { connect, sendMessage, requestNextStep } = actions;\r\n\r\n    // --- Window Manager Hook ---\r\n    const { windows, windowActions, inputWindow, inputWindowActions } = useWindowManager();\r\n\r\n    // --- UI State (local to this component) ---\r\n    const [leftWidth, setLeftWidth] = useState<number>(320);\r\n    const [rightWidth, setRightWidth] = useState<number>(300);\r\n\r\n    const [roleFilter, setRoleFilter] = useState<string>('all');\r\n    const [evidenceFilter, setEvidenceFilter] = useState<string>('all');\r\n    const [selectedRole, setSelectedRole] = useState<UserRole>('Prosecutor AI');\r\n\r\n    // Inputs\r\n    const [inputValue, setInputValue] = useState<string>('');\r\n    const [caseContext, setCaseContext] = useState<string>(\"张三（原告）诉李四（被告）民间借贷纠纷一案...\");\r\n    const [textEvidence, setTextEvidence] = useState<TextEvidence[]>([{ speaker: '原告律师', content: '微信聊天记录：被告承诺\"下周还钱\"' }]);\r\n    const [fileEvidence, setFileEvidence] = useState<FileEvidence[]>([{ speaker: '原告律师', name: '转账记录.pdf', type: 'pdf', url: null }]);\r\n    const [newEvidenceInput, setNewEvidenceInput] = useState<string>('');\r\n    const [newEvidenceSpeaker, setNewEvidenceSpeaker] = useState<string>('原告律师');\r\n\r\n    const [inputHeight, setInputHeight] = useState<number>(120);\r\n    const [isLongFormMode, setIsLongFormMode] = useState<boolean>(false);\r\n\r\n    // --- Actions (using hook functions) ---\r\n    const handleStartTrial = useCallback((): void => {\r\n        connect(selectedRole, caseContext, textEvidence, fileEvidence);\r\n    }, [connect, selectedRole, caseContext, textEvidence, fileEvidence]);\r\n\r\n    const handleNextStep = useCallback((): void => {\r\n        requestNextStep();\r\n    }, [requestNextStep]);\r\n\r\n    const handleSendMessage = useCallback((): void => {\r\n        const success = sendMessage(inputValue, selectedRole);\r\n        if (success) {\r\n            setInputValue('');\r\n        }\r\n    }, [sendMessage, inputValue, selectedRole]);\r\n\r\n    // Role Change Handler (replaces useEffect sync)\r\n    const handleRoleChange = useCallback((newRole: UserRole) => {\r\n        setSelectedRole(newRole);\r\n        if (newRole === 'Prosecutor AI') setNewEvidenceSpeaker('原告律师');\r\n        else if (newRole === 'Defense AI') setNewEvidenceSpeaker('被告律师');\r\n    }, []);\r\n\r\n    // Evidence Handling (memoized)\r\n    const deleteEvidence = useCallback((index: number, isFile: boolean): void => {\r\n        if (window.confirm(\"Are you sure you want to remove this evidence?\")) {\r\n            if (isFile) setFileEvidence(prev => prev.filter((_, i) => i !== index));\r\n            else setTextEvidence(prev => prev.filter((_, i) => i !== index));\r\n        }\r\n    }, []);\r\n\r\n    const handleTextEvidenceEdit = useCallback((index: number, value: string): void => {\r\n        setTextEvidence(prev => {\r\n            const newArr = [...prev];\r\n            newArr[index] = { ...newArr[index], content: value };\r\n            return newArr;\r\n        });\r\n    }, []);\r\n\r\n    const handleAddTextEvidence = useCallback((evidence: TextEvidence): void => {\r\n        setTextEvidence(prev => [...prev, evidence]);\r\n    }, []);\r\n\r\n    const handleAddFileEvidence = useCallback((evidence: FileEvidence): void => {\r\n        setFileEvidence(prev => [...prev, evidence]);\r\n    }, []);\r\n\r\n    // --- Layout Resizing ---\r\n    type ResizeDirection = 'left' | 'right' | 'input';\r\n\r\n    const startResizing = useCallback((direction: ResizeDirection) => (e: React.MouseEvent): void => {\r\n        e.preventDefault();\r\n        const startX = e.clientX;\r\n        const startY = e.clientY;\r\n        const startW = direction === 'left' ? leftWidth : rightWidth;\r\n        const startH = inputHeight;\r\n\r\n        const onMove = (ev: MouseEvent): void => {\r\n            if (direction === 'left' || direction === 'right') {\r\n                const d = ev.clientX - startX;\r\n                if (direction === 'left') setLeftWidth(Math.max(250, Math.min(600, startW + d)));\r\n                else setRightWidth(Math.max(250, Math.min(500, startW - d)));\r\n            } else if (direction === 'input') {\r\n                const d = ev.clientY - startY;\r\n                setInputHeight(Math.max(80, Math.min(600, startH - d)));\r\n            }\r\n        };\r\n\r\n        const onUp = (): void => {\r\n            document.removeEventListener('mousemove', onMove);\r\n            document.removeEventListener('mouseup', onUp);\r\n        };\r\n\r\n        document.addEventListener('mousemove', onMove);\r\n        document.addEventListener('mouseup', onUp);\r\n    }, [leftWidth, rightWidth, inputHeight]);\r\n\r\n    // --- Memoized Props for LeftSidebar (Performance Optimization) ---\r\n    const leftLayoutConfig: LayoutConfig = useMemo(() => ({\r\n        width: leftWidth,\r\n        onStartResize: startResizing('left')\r\n    }), [leftWidth, startResizing]);\r\n\r\n    const caseDataConfig: CaseDataConfig = useMemo(() => ({\r\n        context: caseContext,\r\n        onChange: setCaseContext\r\n    }), [caseContext]);\r\n\r\n    const evidenceDataConfig: EvidenceDataConfig = useMemo(() => ({\r\n        file: fileEvidence,\r\n        text: textEvidence,\r\n        filter: evidenceFilter as 'all' | '原告律师' | '被告律师',\r\n        onFilterChange: setEvidenceFilter,\r\n        onDelete: deleteEvidence,\r\n        onOpen: windowActions.open,\r\n        onTextEdit: handleTextEvidenceEdit\r\n    }), [fileEvidence, textEvidence, evidenceFilter, deleteEvidence, windowActions.open, handleTextEvidenceEdit]);\r\n\r\n    const newEvidenceInputConfig: NewEvidenceInputConfig = useMemo(() => ({\r\n        value: newEvidenceInput,\r\n        onChange: setNewEvidenceInput,\r\n        speaker: newEvidenceSpeaker,\r\n        onSpeakerChange: setNewEvidenceSpeaker,\r\n        onAddText: handleAddTextEvidence,\r\n        onAddFile: handleAddFileEvidence\r\n    }), [newEvidenceInput, newEvidenceSpeaker, handleAddTextEvidence, handleAddFileEvidence]);\r\n\r\n    const sessionInfoConfig: SessionInfoConfig = useMemo(() => ({\r\n        isConnected,\r\n        isTurnToSpeak,\r\n        logs,\r\n        selectedRole\r\n    }), [isConnected, isTurnToSpeak, logs, selectedRole]);\r\n\r\n\r\n    return (\r\n        <div className=\"flex h-screen w-full bg-surface-container-low font-sans text-on-surface overflow-hidden relative selection:bg-primary-container selection:text-on-primary-container\">\r\n\r\n            {/* Windows Layer */}\r\n            {windows.map(win => (\r\n                <DraggableWindow\r\n                    key={win.id}\r\n                    win={win}\r\n                    onClose={windowActions.close}\r\n                    onFocus={windowActions.focus}\r\n                    updatePosition={windowActions.updatePosition}\r\n                    updateSize={windowActions.updateSize}\r\n                />\r\n            ))}\r\n\r\n            {/* LEFT SIDEBAR */}\r\n            <LeftSidebar\r\n                layout={leftLayoutConfig}\r\n                caseData={caseDataConfig}\r\n                evidenceData={evidenceDataConfig}\r\n                newEvidenceInput={newEvidenceInputConfig}\r\n                sessionInfo={sessionInfoConfig}\r\n            />\r\n\r\n            {/* CENTER (Chat) */}\r\n            <ChatArea\r\n                messages={messages}\r\n                roleFilter={roleFilter}\r\n                onRoleFilterChange={setRoleFilter}\r\n                currentPhase={currentPhase}\r\n                currentSpeaker={currentSpeaker}\r\n                sessionId={sessionId}\r\n                isConnected={isConnected}\r\n                inputValue={inputValue}\r\n                onInputChange={setInputValue}\r\n                onSendMessage={handleSendMessage}\r\n                isTurnToSpeak={isTurnToSpeak}\r\n                isLongFormMode={isLongFormMode}\r\n                onExpandInput={() => setIsLongFormMode(true)}\r\n                onCloseLongForm={() => setIsLongFormMode(false)}\r\n                selectedRole={selectedRole}\r\n                inputWindowState={inputWindow}\r\n                onFocusInputWindow={inputWindowActions.focus}\r\n                onUpdateInputWindowPos={inputWindowActions.updatePosition}\r\n                onUpdateInputWindowSize={inputWindowActions.updateSize}\r\n            />\r\n\r\n            {/* RIGHT SIDEBAR */}\r\n            <RightSidebar\r\n                width={rightWidth}\r\n                onStartResize={startResizing('right')}\r\n                selectedRole={selectedRole}\r\n                onRoleChange={handleRoleChange}\r\n                roleOptions={Object.keys(ROLE_MAPPINGS) as UserRole[]}\r\n                isConnected={isConnected}\r\n                isConnecting={isConnecting}\r\n                isTurnToSpeak={isTurnToSpeak}\r\n                currentPhase={currentPhase}\r\n                activeNode={activeNode}\r\n                onStartTrial={handleStartTrial}\r\n                onNextStep={handleNextStep}\r\n            />\r\n\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\CourtClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\components\\Avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\components\\Badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\components\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\components\\DetailedInputWindow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\components\\DraggableWindow.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\components\\EvidenceItem.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\components\\WindowFrame.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\features\\ChatArea\\MessageInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\features\\ChatArea\\MessageList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\features\\ChatArea\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\features\\LeftSidebar\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\features\\RightSidebar\\index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\hooks\\useCourtSession.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\hooks\\useWindowManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\src\\utils\\roleStyles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Desktop3\\debate_mfxb\\mock-court\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]